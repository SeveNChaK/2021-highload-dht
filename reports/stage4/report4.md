### PUT-запросы
По времени видимо все хорошо, однако rate сервис выдерживает низкий, это появилось еще в этапе 2, но было замечено только сейчас.
При повышении значения rate в какой-то момент сервис начнет выдавать OutOfMemory. У нас сильно копится очередь флашей, наверное, из-за
компактов.

    alexey.korneev@WH0132099 2021-highload-dht % wrk2 -c 128 -t 2 -d 5m -L -R 2000 -s wrk/put.lua http://localhost:8082
    
    Running 5m test @ http://localhost:8082
    2 threads and 128 connections
    Thread calibration: mean lat.: 1.077ms, rate sampling interval: 10ms
    
    Thread calibration: mean lat.: 1.056ms, rate sampling interval: 10ms
    Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.08ms  490.78us   7.10ms   65.99%
    Req/Sec     1.05k    94.50     1.55k    77.19%
    
    Latency Distribution (HdrHistogram - Recorded Latency)
    50.000%    1.06ms
    75.000%    1.41ms
    90.000%    1.71ms
    99.000%    2.30ms
    99.900%    3.09ms
    99.990%    4.54ms
    99.999%    5.41ms
    100.000%    7.10ms
    
    Detailed Percentile spectrum:
    Value   Percentile   TotalCount 1/(1-Percentile)

       0.078     0.000000            1         1.00
       0.444     0.100000        58079         1.11
       0.622     0.200000       116189         1.25
       0.773     0.300000       173980         1.43
       0.918     0.400000       232030         1.67
       1.059     0.500000       289728         2.00
       1.128     0.550000       318698         2.22
       1.198     0.600000       347766         2.50
       1.267     0.650000       376733         2.86
       1.339     0.700000       405938         3.33
       1.414     0.750000       434851         4.00
       1.454     0.775000       449145         4.44
       1.497     0.800000       463646         5.00
       1.543     0.825000       478219         5.71
       1.592     0.850000       492476         6.67
       1.648     0.875000       507015         8.00
       1.679     0.887500       514266         8.89
       1.712     0.900000       521455        10.00
       1.749     0.912500       528754        11.43
       1.791     0.925000       535987        13.33
       1.840     0.937500       543212        16.00
       1.868     0.943750       546844        17.78
       1.899     0.950000       550479        20.00
       1.932     0.956250       554020        22.86
       1.971     0.962500       557633        26.67
       2.017     0.968750       561272        32.00
       2.043     0.971875       563098        35.56
       2.073     0.975000       564988        40.00
       2.105     0.978125       566728        45.71
       2.143     0.981250       568526        53.33
       2.185     0.984375       570307        64.00
       2.213     0.985938       571264        71.11
       2.243     0.987500       572172        80.00
       2.275     0.989062       573070        91.43
       2.313     0.990625       573966       106.67
       2.357     0.992188       574839       128.00
       2.387     0.992969       575306       142.22
       2.417     0.993750       575772       160.00
       2.451     0.994531       576198       182.86
       2.491     0.995313       576651       213.33
       2.537     0.996094       577103       256.00
       2.567     0.996484       577325       284.44
       2.601     0.996875       577558       320.00
       2.639     0.997266       577775       365.71
       2.689     0.997656       578002       426.67
       2.751     0.998047       578230       512.00
       2.787     0.998242       578341       568.89
       2.835     0.998437       578453       640.00
       2.893     0.998633       578569       731.43
       2.983     0.998828       578681       853.33
       3.105     0.999023       578793      1024.00
       3.179     0.999121       578850      1137.78
       3.247     0.999219       578907      1280.00
       3.367     0.999316       578962      1462.86
       3.495     0.999414       579021      1706.67
       3.613     0.999512       579076      2048.00
       3.689     0.999561       579104      2275.56
       3.779     0.999609       579132      2560.00
       3.861     0.999658       579160      2925.71
       3.951     0.999707       579189      3413.33
       4.043     0.999756       579217      4096.00
       4.087     0.999780       579231      4551.11
       4.135     0.999805       579245      5120.00
       4.187     0.999829       579259      5851.43
       4.299     0.999854       579274      6826.67
       4.387     0.999878       579288      8192.00
       4.471     0.999890       579295      9102.22
       4.559     0.999902       579302     10240.00
       4.631     0.999915       579309     11702.86
       4.675     0.999927       579317     13653.33
       4.739     0.999939       579323     16384.00
       4.771     0.999945       579327     18204.44
       4.787     0.999951       579330     20480.00
       4.935     0.999957       579335     23405.71
       4.959     0.999963       579337     27306.67
       4.987     0.999969       579341     32768.00
       5.003     0.999973       579343     36408.89
       5.011     0.999976       579344     40960.00
       5.067     0.999979       579346     46811.43
       5.135     0.999982       579348     54613.33
       5.199     0.999985       579350     65536.00
       5.215     0.999986       579351     72817.78
       5.215     0.999988       579351     81920.00
       5.411     0.999989       579352     93622.86
       5.455     0.999991       579353    109226.67
       5.643     0.999992       579354    131072.00
       5.731     0.999993       579355    145635.56
       5.731     0.999994       579355    163840.00
       5.731     0.999995       579355    187245.71
       5.735     0.999995       579356    218453.33
       5.735     0.999996       579356    262144.00
       6.519     0.999997       579357    291271.11
       6.519     0.999997       579357    327680.00
       6.519     0.999997       579357    374491.43
       6.519     0.999998       579357    436906.67
       6.519     0.999998       579357    524288.00
       7.099     0.999998       579358    582542.22
       7.099     1.000000       579358          inf
    [Mean    =        1.078, StdDeviation   =        0.491]
    [Max     =        7.096, Total count    =       579358]
    [Buckets =           27, SubBuckets     =         2048]
    ----------------------------------------------------------
    599746 requests in 5.00m, 47.47MB read
    Requests/sec:   1999.15
    Transfer/sec:    162.02KB
__Результаты профилирования:__  
[PUT cpu](./stage4_put_cpu.html)  
Теперь почти все время занимает работа с сетью, потому что помимо основных запросов, появилось еще и проксирвоание.

[PUT lock](./stage4_put_lock.html)  
Много локов на очереди executor'а. Так же как и на предыдущем этапе. Не удивительно, ведь для этого мы ничего здесь и не меняли.
Ведь фидбека пока нет по предыдущему этапу.

[PUT alloc](./stage4_put_alloc.html)  
Видно, что проксирование заняло свой значительный кусок в памяти.

### GET-запросы
В GET запросах так же видно хорошие тайминги, но есть скачок, который может быть из-за сборщика мусора. Он занимает 20% 
процессорного времени.

    alexey.korneev@WH0132099 2021-highload-dht % wrk2 -c 128 -t 2 -d 2m -L -R 2000 -s wrk/get.lua http://localhost:8081
    
    Running 2m test @ http://localhost:8081
    2 threads and 128 connections
    Thread calibration: mean lat.: 1.069ms, rate sampling interval: 10ms
    
    Thread calibration: mean lat.: 1.038ms, rate sampling interval: 10ms
    Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.16ms    0.94ms  18.29ms   93.73%
    Req/Sec     1.05k   143.76     2.56k    70.44%
    
    Latency Distribution (HdrHistogram - Recorded Latency)
    50.000%    1.04ms
    75.000%    1.42ms
    90.000%    1.77ms
    99.000%    5.89ms
    99.900%   10.49ms
    99.990%   13.24ms
    99.999%   16.72ms
    100.000%   18.30ms
    
    Detailed Percentile spectrum:
    Value   Percentile   TotalCount 1/(1-Percentile)

       0.079     0.000000            2         1.00
       0.425     0.100000        21953         1.11
       0.597     0.200000        43973         1.25
       0.752     0.300000        65916         1.43
       0.899     0.400000        87753         1.67
       1.044     0.500000       109754         2.00
       1.116     0.550000       120654         2.22
       1.189     0.600000       131623         2.50
       1.263     0.650000       142653         2.86
       1.339     0.700000       153574         3.33
       1.419     0.750000       164523         4.00
       1.463     0.775000       170018         4.44
       1.511     0.800000       175565         5.00
       1.562     0.825000       180981         5.71
       1.621     0.850000       186539         6.67
       1.689     0.875000       191949         8.00
       1.728     0.887500       194691         8.89
       1.774     0.900000       197464        10.00
       1.826     0.912500       200167        11.43
       1.889     0.925000       202913        13.33
       1.970     0.937500       205668        16.00
       2.023     0.943750       207027        17.78
       2.081     0.950000       208400        20.00
       2.151     0.956250       209792        22.86
       2.235     0.962500       211149        26.67
       2.357     0.968750       212518        32.00
       2.443     0.971875       213201        35.56
       2.553     0.975000       213878        40.00
       2.733     0.978125       214559        45.71
       3.085     0.981250       215245        53.33
       3.891     0.984375       215930        64.00
       4.379     0.985938       216272        71.11
       4.931     0.987500       216618        80.00
       5.563     0.989062       216958        91.43
       6.127     0.990625       217300       106.67
       6.727     0.992188       217645       128.00
       7.039     0.992969       217815       142.22
       7.407     0.993750       217988       160.00
       7.739     0.994531       218158       182.86
       8.071     0.995313       218332       213.33
       8.479     0.996094       218501       256.00
       8.663     0.996484       218587       284.44
       8.863     0.996875       218671       320.00
       9.111     0.997266       218758       365.71
       9.359     0.997656       218842       426.67
       9.623     0.998047       218928       512.00
       9.751     0.998242       218972       568.89
       9.943     0.998437       219018       640.00
      10.143     0.998633       219058       731.43
      10.335     0.998828       219099       853.33
      10.511     0.999023       219142      1024.00
      10.583     0.999121       219165      1137.78
      10.655     0.999219       219185      1280.00
      10.807     0.999316       219207      1462.86
      11.023     0.999414       219228      1706.67
      11.215     0.999512       219249      2048.00
      11.303     0.999561       219261      2275.56
      11.415     0.999609       219271      2560.00
      11.567     0.999658       219282      2925.71
      11.655     0.999707       219292      3413.33
      11.911     0.999756       219303      4096.00
      12.015     0.999780       219308      4551.11
      12.087     0.999805       219314      5120.00
      12.175     0.999829       219319      5851.43
      12.311     0.999854       219324      6826.67
      12.503     0.999878       219330      8192.00
      12.631     0.999890       219332      9102.22
      13.271     0.999902       219335     10240.00
      13.631     0.999915       219338     11702.86
      13.863     0.999927       219340     13653.33
      14.335     0.999939       219343     16384.00
      14.543     0.999945       219344     18204.44
      14.783     0.999951       219346     20480.00
      14.807     0.999957       219347     23405.71
      14.935     0.999963       219348     27306.67
      15.007     0.999969       219350     32768.00
      15.007     0.999973       219350     36408.89
      15.327     0.999976       219351     40960.00
      15.351     0.999979       219352     46811.43
      15.351     0.999982       219352     54613.33
      15.663     0.999985       219353     65536.00
      15.663     0.999986       219353     72817.78
      16.719     0.999988       219354     81920.00
      16.719     0.999989       219354     93622.86
      16.719     0.999991       219354    109226.67
      17.775     0.999992       219355    131072.00
      17.775     0.999993       219355    145635.56
      17.775     0.999994       219355    163840.00
      17.775     0.999995       219355    187245.71
      17.775     0.999995       219355    218453.33
      18.303     0.999996       219356    262144.00
      18.303     1.000000       219356          inf
    [Mean    =        1.162, StdDeviation   =        0.938]
    [Max     =       18.288, Total count    =       219356]
    [Buckets =           27, SubBuckets     =         2048]
    ----------------------------------------------------------
    239744 requests in 2.00m, 20.35MB read
    Requests/sec:   1997.87
    Transfer/sec:    173.69KB
__Результаты профилирования:__  
[GET cpu](./stage4_get_cpu.html)  
Тут так же как и в PUT почти все время теперь ушло на работу с сетью.

[GET lock](./stage4_get_lock.html)  
Все так же локи из-за накопления очереди, видимо.

[GET alloc](./stage4_get_alloc.html)  
Видно, что проксирование заняло свой значительный кусок в памяти.
